# Migration from Local Storage to Supabase

This document outlines the changes made to migrate the application from using local storage to using Supabase as a real database.

## Changes Made

1. **Installed Supabase Client Library**
   - Added `@supabase/supabase-js` to the project dependencies

2. **Created Supabase Configuration**
   - Created `app/lib/supabase.js` to initialize the Supabase client
   - Added `.env.local` for storing Supabase credentials

3. **Created Database Schema**
   - Created `scripts/setup-supabase.sql` with SQL commands to:
     - Create users and posts tables
     - Insert initial data
     - Set up Row Level Security (RLS) policies

4. **Updated Data Handling**
   - Created `app/lib/supabaseData.js` with async functions to interact with Supabase
   - Replaced local storage operations with Supabase database operations
   - Updated data models to match Supabase column names (e.g., `postedBy` â†’ `posted_by`)

5. **Updated UI Components**
   - Updated all pages to handle async data fetching
   - Added loading states and error handling
   - Updated UI to reflect new data structure

6. **Authentication**
   - Updated login and signup pages to use Supabase for user management
   - Maintained localStorage for client-side user state (in a production app, you would use Supabase Auth)

## Database Schema

### Users Table
```sql
CREATE TABLE IF NOT EXISTS users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  username TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  discord_name TEXT NOT NULL,
  role TEXT NOT NULL DEFAULT 'user',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### Posts Table
```sql
CREATE TABLE IF NOT EXISTS posts (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title TEXT NOT NULL,
  type TEXT NOT NULL,
  description TEXT NOT NULL,
  price TEXT,
  time TEXT,
  status TEXT NOT NULL DEFAULT 'Available',
  posted_by TEXT NOT NULL REFERENCES users(username) ON DELETE CASCADE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  thumbs_up INTEGER DEFAULT 0,
  thumbs_up_by TEXT[] DEFAULT '{}',
  comments JSONB DEFAULT '[]',
  tag TEXT DEFAULT 'general'
);
```

## Security Considerations

- Row Level Security (RLS) policies have been implemented to control access to data
- In a production environment, you should:
  - Use Supabase Auth for proper authentication
  - Hash passwords instead of storing them in plain text
  - Implement more granular access controls
  - Add additional validation on both client and server sides

## Future Improvements

1. **Use Supabase Auth**
   - Replace the custom authentication with Supabase Auth for better security

2. **Implement Real-time Updates**
   - Use Supabase's real-time capabilities to update the UI when data changes

3. **Add Image Upload**
   - Use Supabase Storage to allow users to upload images for their listings

4. **Implement Pagination**
   - Add pagination for posts to improve performance with large datasets

5. **Add User Profiles**
   - Create user profile pages with user-specific information and activity 